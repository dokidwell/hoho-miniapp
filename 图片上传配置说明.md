# å›¾ç‰‡ä¸Šä¼ é…ç½®è¯´æ˜

## ğŸ“¦ å·²å®ç°çš„åŠŸèƒ½

âœ… **å›¾ç‰‡ä¸Šä¼ å·¥å…·** (`frontend/utils/upload.js`)
- æ”¯æŒ3ç§ä¸Šä¼ æ–¹å¼ï¼š
  - æœåŠ¡å™¨ä¸Šä¼ ï¼ˆé»˜è®¤ï¼‰
  - è…¾è®¯äº‘COS
  - é˜¿é‡Œäº‘OSS
- å›¾ç‰‡éªŒè¯ï¼ˆå¤§å°ã€æ ¼å¼ï¼‰
- ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- æ‰¹é‡ä¸Šä¼ æ”¯æŒ

âœ… **åˆ›ä½œé¡µé¢é›†æˆ** (`frontend/pages/create/index.vue`)
- é€‰æ‹©å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ 
- ä¸Šä¼ è¿›åº¦æç¤º
- é”™è¯¯å¤„ç†

---

## ğŸ”§ é…ç½®æ–¹æ³•

### æ–¹æ¡ˆ1ï¼šä¸Šä¼ åˆ°åç«¯æœåŠ¡å™¨ï¼ˆæ¨èæ–°æ‰‹ï¼‰

**ä¼˜ç‚¹**ï¼š
- é…ç½®ç®€å•
- æ— éœ€ç¬¬ä¸‰æ–¹æœåŠ¡
- æˆæœ¬ä½

**ç¼ºç‚¹**ï¼š
- å ç”¨æœåŠ¡å™¨å¸¦å®½
- éœ€è¦è‡ªå·±ç®¡ç†å­˜å‚¨ç©ºé—´

**é…ç½®æ­¥éª¤**ï¼š

1. **ä¿®æ”¹ `frontend/utils/upload.js`**ï¼š
```javascript
const UPLOAD_CONFIG = {
  method: 'server',  // ä½¿ç”¨æœåŠ¡å™¨ä¸Šä¼ 
  serverUrl: `${API_BASE_URL}/api/v1/upload`,
  maxSize: 10 * 1024 * 1024,  // 10MB
}
```

2. **åç«¯å®ç°ä¸Šä¼ æ¥å£**ï¼ˆéœ€è¦æ·»åŠ ï¼‰ï¼š
```go
// backend/handlers/upload.go
func (h *UploadHandler) UploadFile(c *gin.Context) {
    file, err := c.FormFile("file")
    if err != nil {
        c.JSON(400, gin.H{"error": "æ–‡ä»¶ä¸Šä¼ å¤±è´¥"})
        return
    }
    
    // ç”Ÿæˆæ–‡ä»¶å
    filename := fmt.Sprintf("%d_%s", time.Now().Unix(), file.Filename)
    filepath := path.Join("uploads", filename)
    
    // ä¿å­˜æ–‡ä»¶
    if err := c.SaveUploadedFile(file, filepath); err != nil {
        c.JSON(500, gin.H{"error": "æ–‡ä»¶ä¿å­˜å¤±è´¥"})
        return
    }
    
    // è¿”å›æ–‡ä»¶URL
    url := fmt.Sprintf("%s/uploads/%s", config.AppConfig.BaseURL, filename)
    c.JSON(200, gin.H{"url": url})
}
```

3. **åˆ›å»ºuploadsç›®å½•**ï¼š
```bash
mkdir -p /opt/hoho-miniapp/backend/uploads
chmod 755 /opt/hoho-miniapp/backend/uploads
```

4. **é…ç½®Nginxé™æ€æ–‡ä»¶è®¿é—®**ï¼š
```nginx
location /uploads/ {
    alias /opt/hoho-miniapp/backend/uploads/;
    expires 30d;
}
```

---

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨è…¾è®¯äº‘COSï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

**ä¼˜ç‚¹**ï¼š
- CDNåŠ é€Ÿ
- é«˜å¯ç”¨æ€§
- è‡ªåŠ¨å¤‡ä»½
- å›¾ç‰‡å¤„ç†ï¼ˆè£å‰ªã€å‹ç¼©ç­‰ï¼‰

**ç¼ºç‚¹**ï¼š
- éœ€è¦ä»˜è´¹ï¼ˆä½†å¾ˆä¾¿å®œï¼‰
- é…ç½®ç¨å¤æ‚

**é…ç½®æ­¥éª¤**ï¼š

1. **å¼€é€šè…¾è®¯äº‘COS**ï¼š
   - è®¿é—® https://console.cloud.tencent.com/cos
   - åˆ›å»ºå­˜å‚¨æ¡¶ï¼ˆBucketï¼‰
   - è®°å½•ï¼šBucketåç§°ã€æ‰€å±åœ°åŸŸ

2. **è·å–å¯†é’¥**ï¼š
   - è®¿é—® https://console.cloud.tencent.com/cam/capi
   - åˆ›å»ºå¯†é’¥
   - è®°å½•ï¼šSecretIdã€SecretKey

3. **ä¿®æ”¹ `frontend/utils/upload.js`**ï¼š
```javascript
const UPLOAD_CONFIG = {
  method: 'cos',  // ä½¿ç”¨è…¾è®¯äº‘COS
  
  cos: {
    bucket: 'your-bucket-name',  // ä½ çš„Bucketåç§°
    region: 'ap-guangzhou',      // ä½ çš„åœ°åŸŸ
    secretId: '',                // ä¸è¦åœ¨å‰ç«¯é…ç½®ï¼
    secretKey: ''                // ä¸è¦åœ¨å‰ç«¯é…ç½®ï¼
  }
}
```

4. **åç«¯å®ç°ä¸´æ—¶å¯†é’¥æ¥å£**ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰ï¼š
```go
// backend/handlers/upload.go
func (h *UploadHandler) GetCOSCredentials(c *gin.Context) {
    // ä½¿ç”¨STSä¸´æ—¶å¯†é’¥
    // å‚è€ƒï¼šhttps://cloud.tencent.com/document/product/436/14048
    
    credentials := map[string]string{
        "sessionToken": "ä¸´æ—¶Token",
        "authorization": "ä¸´æ—¶æˆæƒ",
        "expiredTime": "è¿‡æœŸæ—¶é—´",
    }
    
    c.JSON(200, credentials)
}
```

5. **é…ç½®CORS**ï¼š
åœ¨è…¾è®¯äº‘COSæ§åˆ¶å°é…ç½®è·¨åŸŸè®¿é—®ï¼š
```
å…è®¸çš„æ¥æºï¼š*
å…è®¸çš„æ–¹æ³•ï¼šGET, POST, PUT
å…è®¸çš„Headerï¼š*
```

---

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨é˜¿é‡Œäº‘OSS

**é…ç½®æ­¥éª¤**ï¼š

1. **å¼€é€šé˜¿é‡Œäº‘OSS**ï¼š
   - è®¿é—® https://oss.console.aliyun.com/
   - åˆ›å»ºBucket
   - è®°å½•ï¼šBucketåç§°ã€Endpoint

2. **è·å–AccessKey**ï¼š
   - è®¿é—® https://ram.console.aliyun.com/manage/ak
   - åˆ›å»ºAccessKey
   - è®°å½•ï¼šAccessKeyIdã€AccessKeySecret

3. **ä¿®æ”¹ `frontend/utils/upload.js`**ï¼š
```javascript
const UPLOAD_CONFIG = {
  method: 'oss',  // ä½¿ç”¨é˜¿é‡Œäº‘OSS
  
  oss: {
    bucket: 'your-bucket-name',
    region: 'oss-cn-hangzhou',
    accessKeyId: '',      // ä¸è¦åœ¨å‰ç«¯é…ç½®ï¼
    accessKeySecret: ''   // ä¸è¦åœ¨å‰ç«¯é…ç½®ï¼
  }
}
```

4. **åç«¯å®ç°STSä¸´æ—¶å‡­è¯æ¥å£**

5. **é…ç½®CORS**ï¼ˆåŒè…¾è®¯äº‘COSï¼‰

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### å¼€å‘æµ‹è¯•é˜¶æ®µ
**ä½¿ç”¨æ–¹æ¡ˆ1ï¼ˆæœåŠ¡å™¨ä¸Šä¼ ï¼‰**
- é…ç½®ç®€å•
- å¿«é€Ÿå¼€å§‹
- æ— éœ€é¢å¤–è´¹ç”¨

### ç”Ÿäº§ç¯å¢ƒ
**ä½¿ç”¨æ–¹æ¡ˆ2ï¼ˆè…¾è®¯äº‘COSï¼‰æˆ–æ–¹æ¡ˆ3ï¼ˆé˜¿é‡Œäº‘OSSï¼‰**
- æ€§èƒ½æ›´å¥½
- æ›´ä¸“ä¸š
- æˆæœ¬ä¸é«˜ï¼ˆæ¯æœˆå‡ å…ƒï¼‰

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### è…¾è®¯äº‘COS
- å­˜å‚¨è´¹ç”¨ï¼š0.099å…ƒ/GB/æœˆ
- æµé‡è´¹ç”¨ï¼š0.5å…ƒ/GB
- **é¢„è®¡**ï¼š10GBå­˜å‚¨ + 100GBæµé‡ â‰ˆ 51å…ƒ/æœˆ

### é˜¿é‡Œäº‘OSS
- å­˜å‚¨è´¹ç”¨ï¼š0.12å…ƒ/GB/æœˆ
- æµé‡è´¹ç”¨ï¼š0.5å…ƒ/GB
- **é¢„è®¡**ï¼š10GBå­˜å‚¨ + 100GBæµé‡ â‰ˆ 51.2å…ƒ/æœˆ

---

## âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

### âŒ ä¸è¦åœ¨å‰ç«¯é…ç½®å¯†é’¥ï¼

**é”™è¯¯ç¤ºä¾‹**ï¼š
```javascript
// âŒ å±é™©ï¼å¯†é’¥ä¼šæš´éœ²åœ¨å°ç¨‹åºä»£ç ä¸­
const UPLOAD_CONFIG = {
  cos: {
    secretId: 'AKIDxxxxx',
    secretKey: 'xxxxxxxx'
  }
}
```

**æ­£ç¡®åšæ³•**ï¼š
1. å¯†é’¥åªå­˜å‚¨åœ¨åç«¯
2. å‰ç«¯é€šè¿‡APIè·å–ä¸´æ—¶å‡­è¯
3. ä¸´æ—¶å‡­è¯æœ‰æ•ˆæœŸçŸ­ï¼ˆ1å°æ—¶ï¼‰
4. ä¸´æ—¶å‡­è¯æƒé™æœ€å°åŒ–ï¼ˆåªèƒ½ä¸Šä¼ ï¼‰

---

## ğŸ“ åç»­å·¥ä½œ

### å¦‚æœé€‰æ‹©æ–¹æ¡ˆ1ï¼ˆæœåŠ¡å™¨ä¸Šä¼ ï¼‰
1. âœ… åˆ›å»º `backend/handlers/upload.go`
2. âœ… åœ¨ `main.go` ä¸­æ·»åŠ è·¯ç”±
3. âœ… åˆ›å»ºuploadsç›®å½•
4. âœ… é…ç½®Nginx

### å¦‚æœé€‰æ‹©æ–¹æ¡ˆ2/3ï¼ˆäº‘å­˜å‚¨ï¼‰
1. âœ… å¼€é€šäº‘å­˜å‚¨æœåŠ¡
2. âœ… è·å–å¯†é’¥
3. âœ… ä¿®æ”¹å‰ç«¯é…ç½®
4. âœ… å®ç°åç«¯ä¸´æ—¶å‡­è¯æ¥å£
5. âœ… é…ç½®CORS

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆæ–¹æ¡ˆ1ï¼‰

**5åˆ†é’Ÿå¿«é€Ÿé…ç½®**ï¼š

```bash
# 1. åˆ›å»ºuploadsç›®å½•
mkdir -p /opt/hoho-miniapp/backend/uploads
chmod 755 /opt/hoho-miniapp/backend/uploads

# 2. ä¿®æ”¹å‰ç«¯é…ç½®ï¼ˆå·²é»˜è®¤é…ç½®ï¼‰
# frontend/utils/upload.js ä¸­ method å·²è®¾ç½®ä¸º 'server'

# 3. åç«¯æ·»åŠ ä¸Šä¼ æ¥å£ï¼ˆéœ€è¦æ‰‹åŠ¨æ·»åŠ ä»£ç ï¼‰
# å‚è€ƒä¸Šé¢çš„ä»£ç ç¤ºä¾‹

# 4. é…ç½®Nginxï¼ˆåœ¨deploy.shä¸­å·²åŒ…å«ï¼‰
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœä½ éœ€è¦æˆ‘å¸®ä½ ï¼š
1. âœ… å®ç°åç«¯ä¸Šä¼ æ¥å£ï¼ˆæ–¹æ¡ˆ1ï¼‰
2. âœ… å®ç°ä¸´æ—¶å‡­è¯æ¥å£ï¼ˆæ–¹æ¡ˆ2/3ï¼‰
3. âœ… é…ç½®äº‘å­˜å‚¨æœåŠ¡

**éšæ—¶å‘Šè¯‰æˆ‘ï¼** ğŸ¤
