# åç«¯éƒ¨ç½²è¯¦ç»†æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰

### ä¸€é”®éƒ¨ç½²è„šæœ¬

æˆ‘å·²ç»ä¸ºä½ å‡†å¤‡äº†ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼Œåªéœ€è¦3ä¸ªå‘½ä»¤ï¼š

```bash
# 1. è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# 2. å…‹éš†ä»£ç 
cd /opt
git clone https://github.com/dokidwell/hoho-miniapp.git
cd hoho-miniapp/backend

# 3. è¿è¡Œéƒ¨ç½²è„šæœ¬
sudo bash deploy.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆ**ï¼š
- âœ… å®‰è£…Goã€MySQLã€Redisã€Nginx
- âœ… åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
- âœ… é…ç½®ç¯å¢ƒå˜é‡
- âœ… ç¼–è¯‘é¡¹ç›®
- âœ… åˆ›å»ºç³»ç»ŸæœåŠ¡
- âœ… é…ç½®Nginxåå‘ä»£ç†
- âœ… å¯åŠ¨æœåŠ¡

**é¢„è®¡æ—¶é—´**ï¼š10-15åˆ†é’Ÿ

---

## ğŸ“‹ éƒ¨ç½²è¿‡ç¨‹ä¸­çš„é—®é¢˜è§£ç­”

### 1. MySQL rootå¯†ç 
- **é¦–æ¬¡å®‰è£…**ï¼šç›´æ¥å›è½¦ï¼ˆæ²¡æœ‰å¯†ç ï¼‰
- **å·²å®‰è£…**ï¼šè¾“å…¥ä½ è®¾ç½®çš„å¯†ç 

### 2. æ•°æ®åº“é…ç½®
- **æ•°æ®åº“å**ï¼šå»ºè®®ä½¿ç”¨ `hoho_park`
- **ç”¨æˆ·å**ï¼šå»ºè®®ä½¿ç”¨ `hoho`
- **å¯†ç **ï¼šè®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ˆè‡³å°‘8ä½ï¼ŒåŒ…å«å­—æ¯æ•°å­—ï¼‰

### 3. JWTå¯†é’¥
- è„šæœ¬ä¼šè‡ªåŠ¨ç”Ÿæˆ
- æˆ–è€…ä½ å¯ä»¥è‡ªå·±è¾“å…¥ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼ˆè‡³å°‘32ä½ï¼‰

### 4. APIåŸŸå
- è¾“å…¥ä½ å·²å¤‡æ¡ˆçš„åŸŸåï¼Œå¦‚ `api.hohopark.com`
- ç¡®ä¿åŸŸåå·²è§£æåˆ°æœåŠ¡å™¨IP

---

## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²ï¼ˆå¦‚æœè„šæœ¬å¤±è´¥ï¼‰

### æ­¥éª¤1: å®‰è£…è½¯ä»¶

```bash
# æ›´æ–°è½¯ä»¶åŒ…
apt update

# å®‰è£…Go
wget https://go.dev/dl/go1.21.0.linux-amd64.tar.gz
tar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯å®‰è£…
go version

# å®‰è£…MySQL
apt install -y mysql-server
systemctl start mysql
systemctl enable mysql

# å®‰è£…Redis
apt install -y redis-server
systemctl start redis
systemctl enable redis

# å®‰è£…Nginx
apt install -y nginx
systemctl start nginx
systemctl enable nginx
```

### æ­¥éª¤2: é…ç½®MySQL

```bash
# ç™»å½•MySQL
mysql -u root -p

# åœ¨MySQLä¸­æ‰§è¡Œ
CREATE DATABASE hoho_park CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'hoho'@'localhost' IDENTIFIED BY 'ä½ çš„å¯†ç ';
GRANT ALL PRIVILEGES ON hoho_park.* TO 'hoho'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### æ­¥éª¤3: å…‹éš†ä»£ç 

```bash
cd /opt
git clone https://github.com/dokidwell/hoho-miniapp.git
cd hoho-miniapp/backend
```

### æ­¥éª¤4: é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®
nano .env
```

ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š
```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=hoho
DB_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 
DB_NAME=hoho_park

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

JWT_SECRET=ä½ çš„JWTå¯†é’¥ï¼ˆè‡³å°‘32ä½éšæœºå­—ç¬¦ä¸²ï¼‰

SERVER_PORT=8080
SERVER_MODE=release
```

### æ­¥éª¤5: ç¼–è¯‘é¡¹ç›®

```bash
# ä¸‹è½½ä¾èµ–
go mod download

# ç¼–è¯‘
go build -o hoho-backend main.go

# æµ‹è¯•è¿è¡Œ
./hoho-backend
```

å¦‚æœçœ‹åˆ° "Server started on :8080"ï¼Œè¯´æ˜ç¼–è¯‘æˆåŠŸï¼

æŒ‰ `Ctrl+C` åœæ­¢æµ‹è¯•ã€‚

### æ­¥éª¤6: åˆ›å»ºç³»ç»ŸæœåŠ¡

```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
nano /etc/systemd/system/hoho-backend.service
```

å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š
```ini
[Unit]
Description=HOHO Backend Service
After=network.target mysql.service redis.service

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/opt/hoho-miniapp/backend
ExecStart=/opt/hoho-miniapp/backend/hoho-backend
Restart=always
RestartSec=5
StandardOutput=append:/var/log/hoho-backend.log
StandardError=append:/var/log/hoho-backend-error.log

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
systemctl daemon-reload
systemctl start hoho-backend
systemctl enable hoho-backend
systemctl status hoho-backend
```

### æ­¥éª¤7: é…ç½®Nginx

```bash
# åˆ›å»ºNginxé…ç½®
nano /etc/nginx/sites-available/hoho-api
```

å†™å…¥ä»¥ä¸‹å†…å®¹ï¼ˆæ›¿æ¢ä½ çš„åŸŸåï¼‰ï¼š
```nginx
server {
    listen 80;
    server_name api.ä½ çš„åŸŸå.com;

    client_max_body_size 10M;

    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
ln -s /etc/nginx/sites-available/hoho-api /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx
```

### æ­¥éª¤8: é…ç½®HTTPSï¼ˆå¿…é¡»ï¼ï¼‰

```bash
# å®‰è£…certbot
apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦
certbot --nginx -d api.ä½ çš„åŸŸå.com

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status hoho-backend

# æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/hoho-backend.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/hoho-backend-error.log
```

### 2. æµ‹è¯•API

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# æˆ–è€…é€šè¿‡åŸŸåæµ‹è¯•
curl https://api.ä½ çš„åŸŸå.com/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "status": "ok"
}
```

### 3. æµ‹è¯•æ³¨å†Œæ¥å£

```bash
curl -X POST https://api.ä½ çš„åŸŸå.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "password": "123456"
  }'
```

å¦‚æœè¿”å›æˆåŠŸï¼Œè¯´æ˜APIå·¥ä½œæ­£å¸¸ï¼

---

## ğŸ” å¸¸è§é—®é¢˜

### é—®é¢˜1: æœåŠ¡å¯åŠ¨å¤±è´¥

**æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
journalctl -u hoho-backend -n 50
```

**å¸¸è§åŸå› **ï¼š
- æ•°æ®åº“è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥ `.env` ä¸­çš„æ•°æ®åº“é…ç½®
- ç«¯å£è¢«å ç”¨ â†’ ä¿®æ”¹ `SERVER_PORT`
- æƒé™é—®é¢˜ â†’ ç¡®ä¿ `ubuntu` ç”¨æˆ·æœ‰æƒé™

### é—®é¢˜2: æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥MySQLçŠ¶æ€**ï¼š
```bash
systemctl status mysql
```

**æµ‹è¯•è¿æ¥**ï¼š
```bash
mysql -u hoho -p hoho_park
```

**é‡ç½®å¯†ç **ï¼š
```bash
mysql -u root -p
ALTER USER 'hoho'@'localhost' IDENTIFIED BY 'æ–°å¯†ç ';
FLUSH PRIVILEGES;
```

### é—®é¢˜3: Nginxé…ç½®é”™è¯¯

**æµ‹è¯•é…ç½®**ï¼š
```bash
nginx -t
```

**æŸ¥çœ‹é”™è¯¯æ—¥å¿—**ï¼š
```bash
tail -f /var/log/nginx/error.log
```

### é—®é¢˜4: HTTPSè¯ä¹¦è·å–å¤±è´¥

**åŸå› **ï¼š
- åŸŸåæœªè§£æåˆ°æœåŠ¡å™¨
- 80ç«¯å£è¢«å ç”¨
- åŸŸåæœªå¤‡æ¡ˆ

**è§£å†³**ï¼š
1. ç¡®è®¤åŸŸåè§£æï¼š`ping api.ä½ çš„åŸŸå.com`
2. æ£€æŸ¥80ç«¯å£ï¼š`netstat -tlnp | grep 80`
3. ç¡®è®¤åŸŸåå·²å¤‡æ¡ˆ

---

## ğŸ“Š æœåŠ¡ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
systemctl status hoho-backend

# å¯åŠ¨æœåŠ¡
systemctl start hoho-backend

# åœæ­¢æœåŠ¡
systemctl stop hoho-backend

# é‡å¯æœåŠ¡
systemctl restart hoho-backend

# æŸ¥çœ‹æ—¥å¿—
journalctl -u hoho-backend -f

# æŸ¥çœ‹æœ€è¿‘50æ¡æ—¥å¿—
journalctl -u hoho-backend -n 50
```

---

## ğŸ”„ æ›´æ–°ä»£ç 

å½“ä»£ç æœ‰æ›´æ–°æ—¶ï¼š

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/hoho-miniapp/backend

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°ç¼–è¯‘
go build -o hoho-backend main.go

# é‡å¯æœåŠ¡
systemctl restart hoho-backend

# æŸ¥çœ‹çŠ¶æ€
systemctl status hoho-backend
```

---

## ğŸ“ éƒ¨ç½²åè®°å½•

**è¯·è®°å½•ä»¥ä¸‹ä¿¡æ¯**ï¼ˆéå¸¸é‡è¦ï¼ï¼‰ï¼š

- æœåŠ¡å™¨IP: _______________
- APIåŸŸå: _______________
- æ•°æ®åº“å: _______________
- æ•°æ®åº“ç”¨æˆ·: _______________
- æ•°æ®åº“å¯†ç : _______________
- JWTå¯†é’¥: _______________
- æœåŠ¡ç«¯å£: _______________

---

## ğŸ¯ ä¸‹ä¸€æ­¥

éƒ¨ç½²å®Œæˆåï¼š
1. âœ… æµ‹è¯•æ‰€æœ‰APIæ¥å£
2. âœ… è®°å½•APIåœ°å€
3. âœ… ä¿®æ”¹å‰ç«¯é…ç½®ï¼ˆ`frontend/api/config.js`ï¼‰
4. âœ… ç¼–è¯‘å‰ç«¯å°ç¨‹åº
5. âœ… æäº¤å®¡æ ¸

---

**å¦‚æœ‰é—®é¢˜ï¼Œéšæ—¶è”ç³»æˆ‘ï¼**
