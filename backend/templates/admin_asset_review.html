{{ define "content" }}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">铸造审核</h1>
</div>

<div class="table-responsive">
    <table class="table table-striped table-sm">
        <thead>
            <tr>
                <th>ID</th>
                <th>藏品名称</th>
                <th>创作者ID</th>
                <th>发行量</th>
                <th>媒体类型</th>
                <th>提交时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {{ range .Assets }}
            <tr>
                <td>{{ .ID }}</td>
                <td>{{ .Name }}</td>
                <td>{{ .CreatorID }}</td>
                <td>{{ .TotalSupply }}</td>
                <td>{{ .MediaType }}</td>
                <td>{{ .CreatedAt.Format "2006-01-02 15:04" }}</td>
                <td>
                    <a href="{{ .MediaURL }}" target="_blank" class="btn btn-sm btn-info">查看作品</a>
                    <button class="btn btn-sm btn-success" onclick="reviewAsset({{ .ID }}, 'approved')">通过</button>
                    <button class="btn btn-sm btn-danger" onclick="reviewAsset({{ .ID }}, 'rejected')">拒绝</button>
                </td>
            </tr>
            {{ else }}
            <tr>
                <td colspan="7" class="text-center">没有待审核的铸造请求</td>
            </tr>
            {{ end }}
        </tbody>
    </table>
</div>

<script>
    function reviewAsset(assetID, status) {
        const actionText = status === 'approved' ? '通过' : '拒绝';
        if (!confirm(`确定要${actionText}藏品ID ${assetID} 的铸造请求吗？`)) {
            return;
        }

        const token = localStorage.getItem('admin_token');
        fetch(`/admin/assets/${assetID}/review`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ status: status })
        })
        .then(response => response.json())
        .then(data => {
            if (data.code === 0) {
                alert('操作成功');
                window.location.reload();
            } else {
                alert('操作失败: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('网络错误，操作失败');
        });
    }
</script>
{{ end }}
