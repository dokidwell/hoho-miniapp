# ğŸ“Š æ•°æ®åº“åˆå§‹åŒ–æŒ‡å—

## âš ï¸ é‡è¦æç¤º

**å½“å‰ç”Ÿäº§æœåŠ¡å™¨çš„æ•°æ®åº“è¡¨è¿˜æœªåˆ›å»ºï¼**

è¿™ä¼šå¯¼è‡´æ‰€æœ‰APIè°ƒç”¨å¤±è´¥ï¼Œè¿”å›"Table doesn't exist"é”™è¯¯ã€‚

---

## ğŸš€ å¿«é€Ÿåˆå§‹åŒ–

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨init.sqlè„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. SSHç™»å½•æœåŠ¡å™¨
ssh ubuntu@119.45.242.49

# 2. ä¸Šä¼ init.sqlåˆ°æœåŠ¡å™¨ï¼ˆæˆ–ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼‰
# ä»GitHubä¸‹è½½
cd /opt/hoho-miniapp/backend
wget https://raw.githubusercontent.com/dokidwell/hoho-miniapp/main/backend/init.sql

# 3. æ‰§è¡ŒSQLè„šæœ¬
sudo mysql hoho_miniapp < init.sql

# 4. éªŒè¯è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
sudo mysql hoho_miniapp -e "SHOW TABLES;"
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨GORMè‡ªåŠ¨è¿ç§»

```bash
# 1. SSHç™»å½•æœåŠ¡å™¨
ssh ubuntu@119.45.242.49

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/hoho-miniapp/backend

# 3. åˆ›å»ºè¿ç§»è„šæœ¬
cat > migrate.go << 'EOF'
package main

import (
	"fmt"
	"log"
	"hoho-miniapp/backend/config"
	"hoho-miniapp/backend/database"
	"hoho-miniapp/backend/models"
)

func main() {
	// åŠ è½½é…ç½®
	config.LoadConfig()
	
	// è¿æ¥æ•°æ®åº“
	database.InitDB()
	
	// è‡ªåŠ¨è¿ç§»
	err := database.DB.AutoMigrate(
		&models.User{},
		&models.UserPoint{},
		&models.PointTransaction{},
		&models.ThirdPartyAccount{},
		&models.Collection{},
		&models.Asset{},
		&models.AssetInstance{},
		&models.JingtanAsset{},
		&models.Listing{},
		&models.Trade{},
		&models.CommunityEvent{},
		&models.Admin{},
	)
	
	if err != nil {
		log.Fatal("æ•°æ®åº“è¿ç§»å¤±è´¥:", err)
	}
	
	fmt.Println("âœ… æ•°æ®åº“è¿ç§»æˆåŠŸï¼")
}
EOF

# 4. è¿è¡Œè¿ç§»
export PATH=$PATH:/usr/local/go/bin
export GOPROXY=https://goproxy.cn,direct
go run migrate.go

# 5. åˆ é™¤è¿ç§»è„šæœ¬
rm migrate.go
```

---

## ğŸ“‹ æ•°æ®åº“è¡¨æ¸…å•

åˆå§‹åŒ–ååº”è¯¥æœ‰ä»¥ä¸‹12ä¸ªè¡¨ï¼š

1. **users** - ç”¨æˆ·è¡¨
2. **user_points** - ç”¨æˆ·ç§¯åˆ†è¡¨
3. **point_transactions** - ç§¯åˆ†äº¤æ˜“è®°å½•è¡¨
4. **collections** - è—å“é›†åˆè¡¨
5. **assets** - è—å“è¡¨
6. **asset_instances** - è—å“å®ä¾‹è¡¨
7. **listings** - äº¤æ˜“æŒ‚å•è¡¨
8. **trades** - äº¤æ˜“è®°å½•è¡¨
9. **third_party_accounts** - ç¬¬ä¸‰æ–¹è´¦æˆ·ç»‘å®šè¡¨
10. **jingtan_assets** - é²¸æ¢èµ„äº§æ˜ å°„è¡¨
11. **community_events** - ç¤¾åŒºäº‹ä»¶è¡¨
12. **admins** - ç®¡ç†å‘˜è¡¨

---

## âœ… éªŒè¯åˆå§‹åŒ–

### æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»º

```bash
sudo mysql hoho_miniapp -e "SHOW TABLES;"
```

é¢„æœŸè¾“å‡ºï¼š
```
+---------------------------+
| Tables_in_hoho_miniapp    |
+---------------------------+
| admins                    |
| asset_instances           |
| assets                    |
| collections               |
| community_events          |
| jingtan_assets            |
| listings                  |
| point_transactions        |
| third_party_accounts      |
| trades                    |
| user_points               |
| users                     |
+---------------------------+
```

### æ£€æŸ¥è¡¨ç»“æ„

```bash
# æŸ¥çœ‹usersè¡¨ç»“æ„
sudo mysql hoho_miniapp -e "DESCRIBE users;"

# æŸ¥çœ‹æ‰€æœ‰è¡¨çš„è¡Œæ•°
sudo mysql hoho_miniapp -e "
SELECT 
    table_name, 
    table_rows 
FROM 
    information_schema.tables 
WHERE 
    table_schema = 'hoho_miniapp'
ORDER BY 
    table_name;
"
```

---

## ğŸ‘¤ åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨bcryptç”Ÿæˆå¯†ç å“ˆå¸Œ

```bash
# 1. å®‰è£…bcryptå·¥å…·
go install github.com/bitnami/bcrypt-cli@latest

# 2. ç”Ÿæˆå¯†ç å“ˆå¸Œï¼ˆå¯†ç ï¼šAdmin@123456ï¼‰
~/go/bin/bcrypt-cli Admin@123456

# 3. æ’å…¥ç®¡ç†å‘˜è´¦æˆ·
sudo mysql hoho_miniapp << EOF
INSERT INTO admins (username, password_hash, email, role, status, created_at, updated_at) 
VALUES (
    'admin', 
    '\$2a\$10\$ä½ ç”Ÿæˆçš„å“ˆå¸Œå€¼', 
    'admin@hohopark.com', 
    'super_admin', 
    'active',
    NOW(),
    NOW()
);
EOF
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨Pythonç”Ÿæˆ

```python
import bcrypt

password = "Admin@123456"
hashed = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())
print(hashed.decode('utf-8'))
```

ç„¶åæ’å…¥æ•°æ®åº“ï¼š

```bash
sudo mysql hoho_miniapp << EOF
INSERT INTO admins (username, password_hash, email, role, status, created_at, updated_at) 
VALUES (
    'admin', 
    'ä½ ç”Ÿæˆçš„å“ˆå¸Œå€¼', 
    'admin@hohopark.com', 
    'super_admin', 
    'active',
    NOW(),
    NOW()
);
EOF
```

---

## ğŸ”„ é‡å¯æœåŠ¡

åˆå§‹åŒ–æ•°æ®åº“åï¼Œé‡å¯åç«¯æœåŠ¡ï¼š

```bash
sudo systemctl restart hoho-api
sudo systemctl status hoho-api
```

---

## ğŸ§ª æµ‹è¯•API

### æµ‹è¯•è—å“åˆ—è¡¨

```bash
curl https://api.hohopark.com/api/v1/assets
```

é¢„æœŸè¿”å›ï¼š
```json
{
  "code": 0,
  "data": [],
  "message": "success"
}
```

### æµ‹è¯•ç”¨æˆ·æ³¨å†Œ

```bash
curl -X POST https://api.hohopark.com/api/v1/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "password": "Test123456",
    "confirm_password": "Test123456",
    "code": "123456"
  }'
```

### æµ‹è¯•ç®¡ç†å‘˜ç™»å½•

```bash
curl -X POST https://api.hohopark.com/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "Admin@123456"
  }'
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½æ•°æ®åº“**
   ```bash
   sudo mysqldump hoho_miniapp > backup_$(date +%Y%m%d).sql
   ```

2. **å­—ç¬¦é›†æ£€æŸ¥**
   - ç¡®ä¿ä½¿ç”¨ utf8mb4 å­—ç¬¦é›†
   - æ”¯æŒemojiå’Œç‰¹æ®Šå­—ç¬¦

3. **ç´¢å¼•ä¼˜åŒ–**
   - init.sqlå·²åŒ…å«35ä¸ªç´¢å¼•
   - æ ¹æ®å®é™…æŸ¥è¯¢ä¼˜åŒ–ç´¢å¼•

4. **å¤–é”®çº¦æŸ**
   - å·²å®šä¹‰13ä¸ªå¤–é”®çº¦æŸ
   - ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šè¡¨å·²å­˜åœ¨

```bash
# åˆ é™¤æ‰€æœ‰è¡¨ï¼ˆå±é™©æ“ä½œï¼ï¼‰
sudo mysql hoho_miniapp -e "
SET FOREIGN_KEY_CHECKS = 0;
DROP TABLE IF EXISTS users, user_points, point_transactions, collections, 
                     assets, asset_instances, listings, trades, 
                     third_party_accounts, jingtan_assets, community_events, admins;
SET FOREIGN_KEY_CHECKS = 1;
"

# é‡æ–°è¿è¡Œinit.sql
sudo mysql hoho_miniapp < init.sql
```

### é—®é¢˜2ï¼šæƒé™ä¸è¶³

```bash
# æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æƒé™
sudo mysql -e "SHOW GRANTS FOR 'hoho'@'localhost';"

# å¦‚æœæƒé™ä¸è¶³ï¼Œé‡æ–°æˆæƒ
sudo mysql -e "
GRANT ALL PRIVILEGES ON hoho_miniapp.* TO 'hoho'@'localhost';
FLUSH PRIVILEGES;
"
```

### é—®é¢˜3ï¼šè¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥MySQLçŠ¶æ€
sudo systemctl status mysql

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 3306

# æµ‹è¯•è¿æ¥
mysql -u hoho -p -h 127.0.0.1 hoho_miniapp
```

---

## ğŸ‰ å®Œæˆ

åˆå§‹åŒ–å®Œæˆåï¼š

1. âœ… 12ä¸ªæ•°æ®åº“è¡¨å·²åˆ›å»º
2. âœ… ç´¢å¼•å’Œå¤–é”®å·²é…ç½®
3. âœ… ç®¡ç†å‘˜è´¦æˆ·å·²åˆ›å»º
4. âœ… APIå¯ä»¥æ­£å¸¸è®¿é—®

ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨å°ç¨‹åºäº†ï¼ğŸš€
