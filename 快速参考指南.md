# ğŸš€ HOHOå°ç¨‹åºå¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸ“ é‡è¦ä¿¡æ¯

**æœåŠ¡å™¨**ï¼š119.45.242.49  
**APIåŸŸå**ï¼šhttps://api.hohopark.com  
**å°ç¨‹åºAppID**ï¼šwx4b69e053a557da87  

---

## ğŸ”‘ SSHç™»å½•

```bash
# ä½¿ç”¨SSHå¯†é’¥ç™»å½•ï¼ˆå¯†ç ç™»å½•å·²ç¦ç”¨ï¼‰
ssh -i /path/to/your/private_key ubuntu@119.45.242.49
```

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### åç«¯æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status hoho-api

# å¯åŠ¨æœåŠ¡
sudo systemctl start hoho-api

# åœæ­¢æœåŠ¡
sudo systemctl stop hoho-api

# é‡å¯æœåŠ¡
sudo systemctl restart hoho-api

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u hoho-api -f

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
sudo journalctl -u hoho-api -n 100
```

### Nginxç®¡ç†

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status nginx

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/hoho-api-access.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/hoho-api-error.log
```

### æ•°æ®åº“ç®¡ç†

```bash
# ç™»å½•MySQL
sudo mysql

# æŸ¥çœ‹æ•°æ®åº“
SHOW DATABASES;

# ä½¿ç”¨hohoæ•°æ®åº“
USE hoho_miniapp;

# æŸ¥çœ‹è¡¨
SHOW TABLES;

# å¤‡ä»½æ•°æ®åº“
sudo mysqldump -u hoho -p hoho_miniapp > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
sudo mysql -u hoho -p hoho_miniapp < backup_20251119.sql
```

### Redisç®¡ç†

```bash
# è¿æ¥Redisï¼ˆéœ€è¦å¯†ç ï¼‰
redis-cli -a 'HoHo@Redis#2024\!Secure'

# æŸ¥çœ‹æ‰€æœ‰key
KEYS *

# æŸ¥çœ‹Redisä¿¡æ¯
INFO

# æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆå±é™©æ“ä½œï¼ï¼‰
FLUSHALL
```

---

## ğŸ“‚ é‡è¦ç›®å½•

```
/opt/hoho-miniapp/          # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ backend/                # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ hoho-api           # å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ .env               # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â”œâ”€â”€ main.go            # ä¸»ç¨‹åº
â”‚   â””â”€â”€ ...
â””â”€â”€ uploads/               # æœ¬åœ°ä¸Šä¼ ç›®å½•ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

/var/log/hoho-miniapp/      # åº”ç”¨æ—¥å¿—
â”œâ”€â”€ app.log                # åº”ç”¨æ—¥å¿—
â””â”€â”€ error.log              # é”™è¯¯æ—¥å¿—

/var/log/nginx/             # Nginxæ—¥å¿—
â”œâ”€â”€ hoho-api-access.log    # è®¿é—®æ—¥å¿—
â””â”€â”€ hoho-api-error.log     # é”™è¯¯æ—¥å¿—

/etc/nginx/sites-available/ # Nginxé…ç½®
â””â”€â”€ api.hohopark.com.conf  # APIé…ç½®æ–‡ä»¶

/etc/systemd/system/        # systemdæœåŠ¡
â””â”€â”€ hoho-api.service       # åç«¯æœåŠ¡é…ç½®

/etc/letsencrypt/           # SSLè¯ä¹¦
â””â”€â”€ live/api.hohopark.com/ # è¯ä¹¦æ–‡ä»¶
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶ä½ç½®

**åç«¯ç¯å¢ƒå˜é‡**ï¼š`/opt/hoho-miniapp/backend/.env`  
**Nginxé…ç½®**ï¼š`/etc/nginx/sites-available/api.hohopark.com.conf`  
**systemdæœåŠ¡**ï¼š`/etc/systemd/system/hoho-api.service`  
**MySQLé…ç½®**ï¼š`/etc/mysql/mysql.conf.d/mysqld.cnf`  
**Redisé…ç½®**ï¼š`/etc/redis/redis.conf`  

---

## ğŸ› æ•…éšœæ’æŸ¥

### 1. åç«¯æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
sudo journalctl -u hoho-api -n 50

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 8080

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cd /opt/hoho-miniapp/backend
./hoho-api
```

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥MySQLçŠ¶æ€
sudo systemctl status mysql

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u hoho -p -h 127.0.0.1

# æŸ¥çœ‹MySQLé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/mysql/error.log
```

### 3. Redisè¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥RedisçŠ¶æ€
sudo systemctl status redis-server

# æµ‹è¯•Redisè¿æ¥
redis-cli -a 'HoHo@Redis#2024\!Secure' ping

# æŸ¥çœ‹Redisæ—¥å¿—
sudo tail -f /var/log/redis/redis-server.log
```

### 4. Nginx 502é”™è¯¯

```bash
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
sudo systemctl status hoho-api

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 8080

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/hoho-api-error.log
```

### 5. SSLè¯ä¹¦é—®é¢˜

```bash
# æŸ¥çœ‹è¯ä¹¦çŠ¶æ€
sudo certbot certificates

# æ‰‹åŠ¨ç»­æœŸ
sudo certbot renew

# æµ‹è¯•ç»­æœŸï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
sudo certbot renew --dry-run
```

---

## ğŸ”„ æ›´æ–°ä»£ç 

### æ›´æ–°åç«¯ä»£ç 

```bash
# 1. ä¸Šä¼ æ–°ä»£ç åˆ°æœåŠ¡å™¨
scp -r backend/ ubuntu@119.45.242.49:/tmp/

# 2. SSHç™»å½•æœåŠ¡å™¨
ssh ubuntu@119.45.242.49

# 3. åœæ­¢æœåŠ¡
sudo systemctl stop hoho-api

# 4. å¤‡ä»½æ—§ä»£ç 
sudo cp -r /opt/hoho-miniapp/backend /opt/hoho-miniapp/backend.backup.$(date +%Y%m%d)

# 5. å¤åˆ¶æ–°ä»£ç 
sudo cp -r /tmp/backend/* /opt/hoho-miniapp/backend/

# 6. é‡æ–°ç¼–è¯‘
cd /opt/hoho-miniapp/backend
export PATH=$PATH:/usr/local/go/bin
export GOPROXY=https://goproxy.cn,direct
go build -o hoho-api main.go

# 7. å¯åŠ¨æœåŠ¡
sudo systemctl start hoho-api

# 8. æ£€æŸ¥çŠ¶æ€
sudo systemctl status hoho-api
```

### æ›´æ–°å‰ç«¯ä»£ç 

å‰ç«¯ä»£ç æ›´æ–°åéœ€è¦é‡æ–°ç¼–è¯‘å¹¶ä¸Šä¼ åˆ°å¾®ä¿¡å°ç¨‹åºå¹³å°ã€‚

---

## ğŸ“Š ç›‘æ§å‘½ä»¤

### ç³»ç»Ÿèµ„æºç›‘æ§

```bash
# CPUå’Œå†…å­˜ä½¿ç”¨
top

# ç£ç›˜ä½¿ç”¨
df -h

# ç£ç›˜IO
iostat

# ç½‘ç»œè¿æ¥
netstat -an | grep ESTABLISHED | wc -l
```

### æœåŠ¡ç›‘æ§

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
sudo systemctl status hoho-api nginx mysql redis-server

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep -E '8080|80|443|3306|6379'

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep -E 'hoho-api|nginx|mysql|redis'
```

---

## ğŸ” å®‰å…¨æ£€æŸ¥

```bash
# æ£€æŸ¥SSHé…ç½®
sudo grep -E 'PasswordAuthentication|PermitRootLogin' /etc/ssh/sshd_config

# æŸ¥çœ‹ç™»å½•æ—¥å¿—
sudo tail -f /var/log/auth.log

# æŸ¥çœ‹å¤±è´¥çš„ç™»å½•å°è¯•
sudo grep "Failed password" /var/log/auth.log

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

---

## ğŸ“ ç´§æ€¥è”ç³»

å¦‚æœé‡åˆ°ä¸¥é‡é—®é¢˜ï¼š

1. **æœåŠ¡å™¨å®•æœº**ï¼šè”ç³»è…¾è®¯äº‘å®¢æœ
2. **æ•°æ®åº“æŸå**ï¼šä»å¤‡ä»½æ¢å¤
3. **SSLè¯ä¹¦è¿‡æœŸ**ï¼šè¿è¡Œ `sudo certbot renew`
4. **ä»£ç bug**ï¼šæŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜

---

## âš¡ å¿«é€Ÿæµ‹è¯•

```bash
# æµ‹è¯•APIå¥åº·æ£€æŸ¥
curl https://api.hohopark.com/health

# æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
curl -X POST https://api.hohopark.com/api/v1/users/register \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"Test123456","code":"123456"}'

# æµ‹è¯•ç”¨æˆ·ç™»å½•
curl -X POST https://api.hohopark.com/api/v1/users/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"Test123456"}'
```

---

## ğŸ“ å¤‡ä»½å»ºè®®

### æ¯æ—¥å¤‡ä»½ï¼ˆå»ºè®®é…ç½®cronå®šæ—¶ä»»åŠ¡ï¼‰

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
sudo nano /opt/backup.sh

# è„šæœ¬å†…å®¹ï¼š
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/opt/backups"
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
mysqldump -u hoho -pHoHo@Prod#2024!Secure hoho_miniapp > $BACKUP_DIR/db_$DATE.sql

# å¤‡ä»½ä»£ç 
tar -czf $BACKUP_DIR/code_$DATE.tar.gz /opt/hoho-miniapp/backend

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

# è®¾ç½®æ‰§è¡Œæƒé™
sudo chmod +x /opt/backup.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œï¼‰
sudo crontab -e
# æ·»åŠ ï¼š0 2 * * * /opt/backup.sh
```

---

**æœ€åæ›´æ–°**ï¼š2025å¹´11æœˆ19æ—¥
